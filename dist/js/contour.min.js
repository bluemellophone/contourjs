(function(){var e;function t(e,t){var i,s,n,o,a,r,l,d,h,c;for(i=e.x,s=e.y,n=t.x,o=t.y,a=Math.min(i,n),r=Math.max(i,n),l=Math.min(s,o),d=r-a,h=Math.max(s,o)-l,i<n&&s<o?c=Math.atan2(h,d):i<n&&s>=o?(c=Math.atan2(h,d),c*=-1):i>=n&&s<o?(c=Math.atan2(d,h),c+=.5*Math.PI):i>=n&&s>=o&&(c=Math.atan2(h,d),c+=Math.PI);c<0;)c+=2*Math.PI;for(;c>2*Math.PI;)c-=2*Math.PI;return c}e=function(){function e(e,t,i){void 0!==i||(i={}),void 0!==i.prefix||(i.prefix=""),void 0!==i.ids||(i.ids={}),void 0!==i.ids.canvas||(i.ids.canvas=i.prefix+"contour-selector-canvas"),void 0!==i.ids.begin||(i.ids.begin=i.prefix+"contour-selector-begin"),void 0!==i.ids.end||(i.ids.end=i.prefix+"contour-selector-end"),void 0!==i.ids.guiderail||(i.ids.guiderail=i.prefix+"contour-selector-guiderail"),void 0!==i.ids.guideline||(i.ids.guideline=i.prefix+"contour-selector-guideline"),void 0!==i.ids.guidepoint||(i.ids.guidepoint=i.prefix+"contour-selector-guidepoint"),void 0!==i.ids.guidearc||(i.ids.guidearc=i.prefix+"contour-selector-guidearc"),void 0!==i.ids.warning||(i.ids.warning=i.prefix+"contour-selector-warning"),void 0!==i.classes||(i.classes={}),void 0!==i.classes.radius||(i.classes.point=i.prefix+"contour-selector-segment-radius"),void 0!==i.classes.segment||(i.classes.point=i.prefix+"contour-selector-segment-point"),void 0!==i.colors||(i.colors={}),void 0!==i.colors.begin||(i.colors.begin="#7FFF7F"),void 0!==i.colors.radius||(i.colors.radius="#2E63FF"),void 0!==i.colors.segment||(i.colors.segment="#2E63FF"),void 0!==i.colors.highlight||(i.colors.highlight="#F0AD4E"),void 0!==i.colors.end||(i.colors.end="#EB2A18"),void 0!==i.colors.guideline||(i.colors.guideline="#EB2A18"),void 0!==i.colors.guidepoint||(i.colors.guidepoint="#EB2A18"),void 0!==i.colors.guidetarget||(i.colors.guidetarget="#333333"),void 0!==i.colors.guidearc||(i.colors.guidearc="#EB2A18"),void 0!==i.colors.guiderail||(i.colors.guiderail="#F0AD4E"),void 0!==i.guiderail||(i.guiderail={}),void 0!==i.guiderail.enabled||(i.guiderail.enabled=!0),void 0!==i.guiderail.percent||(i.guiderail.percent=0),void 0!==i.size||(i.size={}),void 0!==i.size.radius||(i.size.radius=30),void 0!==i.size.segment||(i.size.segment=4),void 0!==i.size.guiderail||(i.size.guiderail=1),void 0!==i.size.paint||(i.size.paint=10),void 0!==i.transparency||(i.transparency={}),void 0!==i.transparency.radius||(i.transparency.radius=.3),void 0!==i.transparency.segment||(i.transparency.segment=1),void 0!==i.transparency.guiderail||(i.transparency.guiderail=.75),void 0!==i.transparency.guidetarget||(i.transparency.guidetarget=.25),void 0!==i.warning||(i.warning="TOO FAST!<br/>GO BACK TO LAST POINT"),void 0!==i.limits||(i.limits={}),void 0!==i.limits.distance||(i.limits.distance=20),void 0!==i.limits.arc||(i.limits.arc={}),void 0!==i.limits.arc.degrees||(i.limits.arc.degrees=45),void 0!==i.limits.arc.radius||(i.limits.arc.radius=50),void 0!==i.limits.restart||(i.limits.restart={}),void 0!==i.limits.restart.min||(i.limits.restart.min=3),void 0!==i.limits.restart.max||(i.limits.restart.max=10),void 0!==i.limits.bounds||(i.limits.bounds={}),void 0!==i.limits.bounds.guiderail||(i.limits.bounds.guiderail=!1),void 0!==i.limits.bounds.x||(i.limits.bounds.x={}),void 0!==i.limits.bounds.x.min||(i.limits.bounds.x.min=0),void 0!==i.limits.bounds.x.max||(i.limits.bounds.x.max=0),void 0!==i.limits.bounds.y||(i.limits.bounds.y={}),void 0!==i.limits.bounds.y.min||(i.limits.bounds.y.min=0),void 0!==i.limits.bounds.y.max||(i.limits.bounds.y.max=0),void 0!==i.debug||(i.debug=!1),void 0!==i.mode||(i.mode="edit"),this.options=i,this.speeding=!1,this.zoom_modifier=1,this.points={segment:[]},this.elements={segment:[]},this.ctx=null,this.create_selector_elements(e),this.create_existing(t)}return e.prototype.resize=function(e){var t,i,s;t=this.elements.frame.width(),i=this.elements.frame.height(),this.elements.canvas.attr("width",t),this.elements.canvas.attr("height",i),canvas_style={width:t+"px",height:i+"px"},this.elements.canvas.css(canvas_style),this.ctx=this.elements.canvas[0].getContext("2d"),this.ctx.clearRect(0,0,this.elements.canvas.width(),this.elements.canvas.height());for(var n=0;n<this.points.segment.length;n++)s=this.points.segment[n],this.draw_segment(s,!0)},e.prototype.create_selector_elements=function(e){var t,i,s,n;this.elements.frame=e,this.elements.frame.width(),this.elements.frame.height(),canvas_style={opacity:this.options.transparency.radius},this.elements.canvas=$('<canvas id="'+this.options.ids.canvas+'"></canvas>'),this.elements.canvas.css(canvas_style),this.elements.frame.append(this.elements.canvas),this.resize(),t={top:"0",left:"0",width:"14px",height:"14px",position:"absolute","border-radius":"14px",border:"1px solid #fff","margin-top":"-8px","margin-left":"-8px","z-index":"2"},this.elements.begin=$('<div id="'+this.options.ids.begin+'"></div>'),this.elements.begin.css(t),this.elements.begin.css({"background-color":this.options.colors.begin}),this.elements.frame.append(this.elements.begin),this.elements.begin.hide(),this.elements.end=$('<div id="'+this.options.ids.end+'"></div>'),this.elements.end.css(t),this.elements.end.css({"background-color":this.options.colors.end}),this.elements.frame.append(this.elements.end),this.elements.end.hide(),this.options.padding=this.options.guiderail.percent/(1+2*this.options.guiderail.percent),i={position:"absolute",top:100*this.options.padding+"%",bottom:100*this.options.padding+"%",left:100*this.options.padding+"%",right:100*this.options.padding+"%",border:this.options.size.guiderail+"px solid "+this.options.colors.guiderail,color:this.options.colors.guiderail,opacity:this.options.transparency.guiderail},this.elements.guiderail=$('<div id="'+this.options.ids.guiderail+'"></div>'),this.elements.guiderail.css(i),this.elements.frame.append(this.elements.guiderail),i={border:"1px solid "+this.options.colors.guideline,position:"absolute","transform-origin":"0% 0%",color:this.options.colors.guideline},this.elements.guideline=$('<div id="'+this.options.ids.guideline+'"></div>'),this.elements.guideline.css(i),this.elements.frame.append(this.elements.guideline),this.elements.guideline.hide(),s={top:"0",left:"0",width:"6px",height:"6px",position:"absolute","border-radius":"6px",border:"1px solid #fff","margin-top":"-4px","margin-left":"-4px","z-index":"2"},this.elements.guidepoint=$('<div id="'+this.options.ids.guidepoint+'"></div>'),this.elements.guidepoint.css(s),this.elements.guidepoint.css({"background-color":this.options.colors.guidepoint}),radius=this.options.size.paint,radius_double=Math.floor(2*radius),guidetarget_style={top:"0",left:"0",width:radius_double+"px",height:radius_double+"px",position:"absolute","border-radius":radius_double+"px",border:"1px solid "+this.options.colors.guidetarget,"margin-top":"-"+(radius-2)+"px","margin-left":"-"+(radius-2)+"px","z-index":"10",opacity:this.options.transparency.guidetarget},this.elements.guidetarget=$('<div id="'+this.options.ids.guidepoint+'"></div>'),this.elements.guidetarget.css(guidetarget_style),this.elements.guidepoint.append(this.elements.guidetarget),this.elements.frame.append(this.elements.guidepoint),this.elements.guidepoint.hide(),radius=Math.floor(this.options.limits.arc.radius),radius_double=Math.floor(2*radius),guidearc_style={position:"absolute",top:"0",left:"0","margin-left":"-"+radius+"px","margin-top":"-"+radius+"px",opacity:"0.3","transform-origin":"50% 50%"},this.elements.guidearc=$('<div id="'+this.options.ids.guidearc+'"></div>'),this.elements.guidearc.css(guidearc_style),degrees=Math.floor(90-this.options.limits.arc.degrees/2),guidearc_arc_style={position:"relative","font-size":"120px",width:radius_double+"px",height:radius_double+"px","-webkit-border-radius":"50%","-moz-border-radius":"50%","-ms-border-radius":"50%","-o-border-radius":"50%","border-radius":"50%",float:"left","background-color":"transparent","-webkit-transform":"rotate("+degrees+"deg)","-moz-transform":"rotate("+degrees+"deg)","-ms-transform":"rotate("+degrees+"deg)","-o-transform":"rotate("+degrees+"deg)",transform:"rotate("+degrees+"deg)"},this.elements.guidearc_arc=$('<div id="'+this.options.ids.guidearc+'-arc"></div>'),this.elements.guidearc_arc.css(guidearc_arc_style),this.elements.guidearc.append(this.elements.guidearc_arc),guidearc_slice_style={position:"absolute",width:radius_double+"px",height:radius_double+"px",clip:"rect(0px, "+radius_double+"px, "+radius_double+"px, "+radius+"px)"},this.elements.guidearc_slice=$('<div id="'+this.options.ids.guidearc+'-slice"></div>'),this.elements.guidearc_slice.css(guidearc_slice_style),this.elements.guidearc_arc.append(this.elements.guidearc_slice),degrees=Math.floor(this.options.limits.arc.degrees),guidearc_bar_style={position:"absolute",border:radius+"px solid red",width:"0px",height:"0px",clip:"rect(0px, "+radius+"px, "+radius_double+"px, 0px)","-webkit-border-radius":"50%","-moz-border-radius":"50%","-ms-border-radius":"50%","-o-border-radius":"50%","border-radius":"50%","-webkit-transform":"rotate("+degrees+"deg)","-moz-transform":"rotate("+degrees+"deg)","-ms-transform":"rotate("+degrees+"deg)","-o-transform":"rotate("+degrees+"deg)",transform:"rotate("+degrees+"deg)"},this.elements.guidearc_bar=$('<div id="'+this.options.ids.guidearc+'-bar"></div>'),this.elements.guidearc_bar.css(guidearc_bar_style),this.elements.guidearc_slice.append(this.elements.guidearc_bar),this.elements.frame.append(this.elements.guidearc),this.elements.guidearc.hide(),n={position:"absolute",top:"0",bottom:"0",left:"0",right:"0",border:"5px solid "+this.options.colors.guidepoint},this.elements.warning=$('<div id="'+this.options.ids.warning+'"></div>'),this.elements.warning.css(n),message_style={position:"relative",width:"100%",color:"#FFFFFF","text-align":"center","background-color":this.options.colors.guidepoint},this.elements.message=$('<div id="'+this.options.ids.warning+'-message">            <b>'+this.options.warning+"</b></div>"),this.elements.message.css(message_style),this.elements.warning.append(this.elements.message),this.elements.frame.append(this.elements.warning),this.elements.warning.hide()},e.prototype.check_boundaries=function(e,t){var i,s,n,o;return void 0!==t||(t=null),n=this.elements.frame.width(),o=this.elements.frame.height(),null==e?null:(null==t&&(i=this.elements.frame.offset(),t={x:e.pageX-i.left,y:e.pageY-i.top}),s={x:{min:0,max:0},y:{min:0,max:0}},this.options.limits.bounds.guiderail&&(s.x.min-=this.options.padding*n,s.x.max-=this.options.padding*n,s.y.min-=this.options.padding*o,s.y.max-=this.options.padding*o),t.x=Math.max(t.x,0-s.x.min),t.y=Math.max(t.y,0-s.y.min),t.x=Math.min(t.x,n-1+s.x.max),t.y=Math.min(t.y,o-1+s.y.max),t)},e.prototype.create_existing=function(e){if(invalid=!1,invalid=invalid||void 0===e.segment,invalid=invalid||void 0===e.segment.length,invalid=invalid||void 0===e.begin,invalid=invalid||void 0===e.end,console.log(e),!invalid){invalid=invalid||e.start<=0,invalid=invalid||e.end<=0,invalid=invalid||e.segment.length<=e.start,invalid=invalid||e.segment.length<=e.end;for(var t=0;t<e.segment.length&&(point=e.segment[t],invalid=invalid||void 0===point.x,invalid=invalid||void 0===point.y,invalid=invalid||void 0===point.r,invalid=invalid||void 0===point.flag,!invalid);t++);}if(invalid&&(e=null),null!=e){width=this.elements.frame.width(),height=this.elements.frame.height(),padding_w=this.options.padding*width,padding_h=this.options.padding*height,local_width=width-2*padding_w,local_height=height-2*padding_h;for(t=0;t<e.segment.length;t++)existing_point=e.segment[t],point={x:{local:existing_point.x},y:{local:existing_point.y},radius:{local:existing_point.r},highlight:existing_point.flag},point.x.pixel=point.x.local*local_width+padding_w,point.x.global=point.x.pixel/width,point.y.pixel=point.y.local*local_height+padding_h,point.y.global=point.y.pixel/height,point.radius.pixel=point.radius.local*local_width,point.radius.global=point.radius.pixel/width,e.segment[t]=point;e.begin=e.segment[e.begin],e.end=e.segment[e.end],console.log(e.begin),console.log(e.end)}this.existing=e,this.draw_existing()},e.prototype.draw_existing=function(){if(this.clear(),null!=this.existing){this.points.segment=this.existing.segment,this.points.begin=this.existing.begin,this.points.end=this.existing.end,this.elements.begin.show(),this.elements.begin.css({top:100*this.points.begin.y.global+"%",left:100*this.points.begin.x.global+"%"}),this.elements.end.show(),this.elements.end.css({top:100*this.points.end.y.global+"%",left:100*this.points.end.x.global+"%"});for(var e=0;e<this.points.segment.length;e++)point=this.points.segment[e],this.draw_segment(point)}},e.prototype.hide_warning=function(){this.elements.warning.hide()},e.prototype.clear=function(e){void 0!==e||(e=null),(e<0||this.points.segment.length<=e)&&(e=null),this.speeding=!1,this.elements.end.hide(),this.elements.begin.hide(),this.elements.guideline.hide(),this.elements.guidepoint.hide(),this.elements.guidearc.hide(),this.ctx.clearRect(0,0,this.elements.canvas.width(),this.elements.canvas.height());for(var t=0;t<this.elements.segment.length;t++)null==e||e<=t?this.elements.segment[t].detach():(point=this.points.segment[t],this.draw_segment(point,!0));null==e?(this.points.segment=[],this.elements.segment=[]):(this.points.segment.splice(e+1),this.elements.segment.splice(e+1))},e.prototype.current_distance=function(e){var t,i,s,n,o;return void 0!==e||(e=this.points.segment.length-1),e<0?[-1,null,null]:(t=this.elements.frame.width(),i=this.elements.frame.height(),s=this.points.segment[e],n=this.points.cursor.x-s.x.global*t,o=this.points.cursor.y-s.y.global*i,[Math.sqrt(Math.pow(n,2)+Math.pow(o,2)),s])},e.prototype.start=function(e,t){if(void 0!==t||(t=null),this.elements.frame.width(),this.elements.frame.height(),this.points.cursor=this.check_boundaries(e),null!=t){if(values=this.current_distance(t),distance=values[0],distance>this.options.limits.restart.min)return!1}else if(null!=this.get_selector_data())return!1;return this.clear(t),point=this.add_segment(e),null==point&&(this.points.segment.length>0?point=this.points.segment[this.points.segment.length-1]:console.log("ASSERTION ERROR! STARTING POINT CANNOT BE NULL")),null==t&&(this.points.begin=point),this.elements.begin.show(),this.elements.begin.css({top:100*this.points.begin.y.global+"%",left:100*this.points.begin.x.global+"%"}),this.elements.frame.css({cursor:"crosshair"}),document.onselectstart=function(){return!1},!0},e.prototype.declutter=function(e){console.log("DECLUTTER: "+e),e?(css_style={opacity:0},radius=0,segment=0):(css_style={opacity:1},radius=this.options.transparency.radius,segment=this.options.transparency.segment),this.elements.end.css(css_style),this.elements.begin.css(css_style),cta.cts.elements.canvas.css({opacity:radius});for(var t=0;t<this.elements.segment.length;t++)this.elements.segment[t].css({opacity:segment})},e.prototype.add_segment=function(e){var t,i,s,n,o,a;return t=this.elements.frame.width(),i=this.elements.frame.height(),s=this.options.padding*t,n=this.options.padding*i,local_width=t-2*s,local_height=i-2*n,o=e.shiftKey,(a={x:{pixel:this.points.cursor.x,global:this.points.cursor.x/t},y:{pixel:this.points.cursor.y,global:this.points.cursor.y/i},radius:{pixel:this.options.size.radius,global:this.options.size.radius/t},highlight:o}).x.local=(a.x.pixel-s)/local_width,a.y.local=(a.y.pixel-n)/local_height,a.radius.local=a.radius.pixel/local_width,this.points.segment.length>0&&(last_index=this.points.segment.length-1,last_point=this.points.segment[last_index],last_point.x.local==a.x.local&&last_point.y.local==a.y.local&&last_point.radius.local==a.radius.local&&last_point.highlight==a.highlight)?null:(this.points.segment.push(a),a)},e.prototype.draw_segment=function(e,t){var i,s,n;void 0!==t||(t=!1),null!=e&&(i=this.elements.frame.width(),s=this.elements.frame.height(),n={x:e.x.global*i,y:e.y.global*s,radius:e.radius.global*i},this.ctx.beginPath(),this.ctx.fillStyle=this.options.colors.radius,this.ctx.ellipse(n.x,n.y,n.radius,n.radius,0,0,2*Math.PI),this.ctx.fill(),t||(size=this.options.size.segment,size_half=size/2,segment_style={top:100*e.y.global+"%",left:100*e.x.global+"%",width:size+"px",height:size+"px",position:"absolute","border-radius":size+"px","margin-top":"-"+size_half+"px","margin-left":"-"+size_half+"px",opacity:this.options.transparency.segment,"z-index":"1"},segment=$('<div class="'+this.options.classes.segment+'"></div>'),segment.css(segment_style),this.elements.frame.append(segment),this.elements.segment.push(segment),index=this.elements.segment.length-1,this.color_segment(index)))},e.prototype.color_segment=function(e){var t;t=this.points.segment[e].highlight?this.options.colors.highlight:this.options.colors.segment,this.elements.segment[e].css({"background-color":t})},e.prototype.update_cursor=function(e,i){var s,n,o,a,r,l,d;if(void 0!==i||(i=!1),this.points.cursor=this.check_boundaries(e),s=this.elements.frame.width(),n=this.elements.frame.height(),values=this.current_distance(),distance=values[0],last=values[1],a=t(l={x:last.x.global*s,y:last.y.global*n},this.points.cursor),css_theta_ma=null,this.speeding&&"draw"==this.options.mode){rate=.8,samples=5,previous=null;for(var h=samples;h>=0;h--)index=this.points.segment.length-1-h,0<=index&&index<this.points.segment.length&&(l={x:(l=this.points.segment[index]).x.global*s,y:l.y.global*n},null==previous?previous=l:null!=l&&(angle=t(previous,l),null==css_theta_ma?css_theta_ma=angle:css_theta_ma=angle*rate+css_theta_ma*(1-rate),previous=l))}return max_distance=this.options.limits.distance,max_distance*=this.zoom_modifier,!this.speeding&&distance>this.options.limits.distance?this.speeding=!0:this.speeding&&("draw"==this.options.mode?this.options.limits.restart.min<=distance&&distance<=this.options.limits.restart.max&&(margin=2*Math.PI*(22/360),diff=css_theta_ma-a,css_theta_min=Math.min(css_theta_ma,a),css_theta_max=Math.max(css_theta_ma,a),diff=css_theta_max-css_theta_min,diff>Math.PI&&(diff-=Math.PI,diff=Math.PI-diff),diff<=margin&&(this.speeding=!1)):this.options.mode),d=!1,this.speeding&&"finish"==this.options.mode&&(this.speeding=!1,d=!0,this.elements.warning.show(),index=this.points.segment.length-1,l={x:(l=this.points.segment[index]).x.global*s,y:l.y.global*n},this.points.cursor=this.check_boundaries(e,l)),this.speeding?(distance<=this.options.limits.restart.min?cursor_style="cell":cursor_style="crosshair",this.elements.frame.css({cursor:cursor_style}),o=Math.max(.5,Math.min(1,distance/200)),this.elements.guideline.css({top:100*last.y.global+"%",left:100*last.x.global+"%",width:distance+"px",opacity:o}),this.elements.guidepoint.css({top:100*last.y.global+"%",left:100*last.x.global+"%",opacity:1}),this.elements.guidearc.css({top:100*last.y.global+"%",left:100*last.x.global+"%",opacity:o}),r={transform:"rotate("+a+"rad)",msTransform:"rotate("+a+"rad)","-o-transform":"rotate("+a+"rad)","-ms-transform":"rotate("+a+"rad)","-moz-transform":"rotate("+a+"rad)","-sand-transform":"rotate("+a+"rad)","-webkit-transform":"rotate("+a+"rad)"},this.elements.guideline.css(r),null==css_theta_ma?this.elements.guidearc.hide():(r={transform:"rotate("+css_theta_ma+"rad)",msTransform:"rotate("+css_theta_ma+"rad)","-o-transform":"rotate("+css_theta_ma+"rad)","-ms-transform":"rotate("+css_theta_ma+"rad)","-moz-transform":"rotate("+css_theta_ma+"rad)","-sand-transform":"rotate("+css_theta_ma+"rad)","-webkit-transform":"rotate("+css_theta_ma+"rad)"},this.elements.guidearc.css(r),this.elements.guidearc.show()),this.elements.guideline.show(),this.elements.guidepoint.show(),this.elements.guidetarget.hide(),this.elements.warning.show()):(this.elements.guideline.hide(),this.elements.guidepoint.hide(),this.elements.guidetarget.hide(),this.elements.guidearc.hide(),d||this.elements.warning.hide(),this.elements.frame.css({cursor:"crosshair"}),i||(l=this.add_segment(e),this.draw_segment(l))),d},e.prototype.update_anchor=function(e){var t,i,s,n,o,a,r;this.points.cursor=this.check_boundaries(e),t=this.elements.frame.width(),i=this.elements.frame.height(),s=1/0,n=null;for(var l=0;l<this.points.segment.length;l++)values=this.current_distance(l),distance=values[0],distance<s&&distance<this.options.size.radius&&(s=distance,n=l);if(null!==n){if(e.shiftKey||e.ctrlKey){a=e.shiftKey,margin=50,o=this.points.segment[n];for(l=n-margin;l<=n+margin;l++)0<=l&&l<this.points.segment.length&&(r=this.points.segment[l],diff_x=(o.x.global-r.x.global)*t,diff_y=(o.y.global-r.y.global)*i,dist=Math.sqrt(Math.pow(diff_x,2)+Math.pow(diff_y,2)),dist<=this.options.size.paint&&(this.points.segment[l].highlight=a,this.color_segment(l)))}closest_values=this.current_distance(n),distance=closest_values[0],last=closest_values[1],distance<=this.options.limits.restart.min?cursor_style="cell":cursor_style="crosshair",this.elements.frame.css({cursor:cursor_style}),this.elements.guidepoint.css({top:100*last.y.global+"%",left:100*last.x.global+"%",opacity:1}),this.elements.guidepoint.show(),this.elements.guidetarget.show()}else this.elements.guidepoint.hide(),this.elements.guidetarget.show();return n},e.prototype.update_radius=function(e){return this.options.size.radius=e,this.options.size.radius},e.prototype.finish=function(e,t){return null==e?(this.clear(),!0):(t&&(this.points.cursor=this.check_boundaries(e)),this.speeding?(values=this.current_distance(),distance=values[0],this.speeding&&"edit"==this.options.mode?(distance<=this.options.limits.restart.min&&(this.speeding=!1,this.update_cursor(e,!0)),!1):(this.clear(),!0)):(this.elements.frame.width(),this.elements.frame.height(),point=this.add_segment(e),null==point&&(point=this.points.segment[this.points.segment.length-1]),this.points.end=point,this.elements.end.show(),this.elements.end.css({top:100*this.points.end.y.global+"%",left:100*this.points.end.x.global+"%"}),$("body").css({cursor:"default"}),document.onselectstart=null,!0))},e.prototype.get_selector_data=function(){var e;if(0==this.points.segment.length)e=null;else{e={begin:0,end:this.points.segment.length-1,segment:[]};for(var t=0;t<this.points.segment.length;t++)point=this.points.segment[t],point_data={x:point.x.local,y:point.y.local,r:point.radius.local,flag:point.highlight},e.segment.push(point_data)}return e},e.prototype.refresh=function(e){return void 0!==e||(e=this.options.guiderail.enabled),this.options.guiderail.enabled=e,this.options.guiderail.enabled?this.elements.guiderail.show():this.elements.guiderail.hide(),data=this.get_selector_data(),data},e}(),this.ContourAnnotator=function(){function t(e,t,i){void 0!==i||(i={}),void 0!==i.prefix||(i.prefix=""),void 0!==i.ids||(i.ids={}),void 0!==i.ids.container||(i.ids.container=i.prefix+"contour-annotator-container"),void 0!==i.props||(i.props={}),void 0!==i.colors||(i.colors={}),void 0!==i.colors.default||(i.colors.default="#7FFF7F"),void 0!==i.actions||(i.actions={}),void 0!==i.actions.click||(i.actions.click={}),void 0!==i.actions.click.right||(i.actions.click.right=!0),void 0!==i.hotkeys||(i.hotkeys={}),void 0!==i.hotkeys.enabled||(i.hotkeys.enabled=!0),void 0!==i.hotkeys.delete||(i.hotkeys.delete=[8,46,75]),void 0!==i.hotkeys.exit||(i.hotkeys.exit=[27]),void 0!==i.hotkeys.zoom||(i.hotkeys.zoom=[90]),void 0!==i.hotkeys.declutter||(i.hotkeys.declutter=[72]),void 0!==i.zoom||(i.zoom={}),void 0!==i.zoom.enabled||(i.zoom.enabled=!0),void 0!==i.limits||(i.limits={}),void 0!==i.limits.frame||(i.limits.frame={}),void 0!==i.limits.frame.width||(i.limits.frame.width=1e3),void 0!==i.limits.frame.height||(i.limits.frame.height=700),void 0!==i.limits.bounds||(i.limits.bounds={}),void 0!==i.limits.bounds.x||(i.limits.bounds.x={}),void 0!==i.limits.bounds.x.min||(i.limits.bounds.x.min=50),void 0!==i.limits.bounds.x.max||(i.limits.bounds.x.max=50),void 0!==i.limits.bounds.y||(i.limits.bounds.y={}),void 0!==i.limits.bounds.y.min||(i.limits.bounds.y.min=50),void 0!==i.limits.bounds.y.max||(i.limits.bounds.y.max=50),void 0!==i.confirm||(i.confirm={}),void 0!==i.confirm.delete||(i.confirm.delete=!0),void 0!==i.confirm.reset||(i.confirm.reset=!0),void 0!==i.callbacks||(i.callbacks={}),void 0!==i.callbacks.onload||(i.callbacks.onload=null),void 0!==i.callbacks.onselector||(i.callbacks.onselector=null),void 0!==i.callbacks.onchange||(i.callbacks.onchange=null),void 0!==i.callbacks.ondelete||(i.callbacks.ondelete=null),void 0!==i.debug||(i.debug=!1),this.existing=t,this.options=i,this.elements=[],this.state={mode:"free",inside:!1,hover:null,which:null,zoom:!1,anchors:{}},this.create_annotator_elements(e)}return t.prototype.create_annotator_elements=function(t){var i;i=this,this.elements.container=$("#"+this.options.ids.container),this.elements.container.css({width:"100%","margin-left":"auto","margin-right":"auto"}),this.elements.frame=$('<div class="'+this.options.prefix+'contour-annotator-frame"></div>'),this.elements.frame.css({position:"relative",width:"100%",height:"100%",border:"#333333 solid 1px",margin:"0px auto","background-size":"100% auto","background-repeat":"no-repeat",overflow:"hidden",cursor:"crosshair"}),this.elements.container.append(this.elements.frame),this.elements.image=new Image,this.elements.image.src=t,this.elements.image.onload=function(){if(i.elements.frame.css({"background-image":'url("'+this.src+'")'}),i.register_global_key_bindings(),i.register_global_event_bindings(),i.resize(),i.cts=new e(i.elements.frame,i.existing,i.options),i.refresh(),null!=i.options.callbacks.onload)return i.options.callbacks.onload()},this.elements.image.onerror=function(){console.log.text("[ContourAnnotator] Invalid image URL provided: "+this.url)}},t.prototype.delete_interaction=function(e){this.options.confirm.delete&&(response=confirm("Are you sure you want to delete this segment?"),!response)||cta.delete_current()},t.prototype.reset_interaction=function(e){this.options.confirm.reset&&(response=confirm("Are you sure you want to reset this segment back to original?"),!response)||cta.reset_existing(e)},t.prototype.register_global_key_bindings=function(e,t){var i;i=this,$(window).keydown(function(e){var t;t=e.which,-1!=i.options.hotkeys.zoom.indexOf(t)&&(i.state.zoom?i.zoom_finish():i.options.hotkeys.enabled&&i.zoom_start()),-1!=i.options.hotkeys.declutter.indexOf(t)&&i.cts.declutter(!0),i.options.hotkeys.enabled&&(-1!=i.options.hotkeys.delete.indexOf(t)&&("selector"==i.state.mode?i.selector_cancel(e):i.delete_interaction(e)),-1!=i.options.hotkeys.exit.indexOf(t)&&("selector"==i.state.mode&&i.selector_cancel(e),i.cts.hide_warning()))}),$(window).keyup(function(e){var t;t=e.which,-1!=i.options.hotkeys.declutter.indexOf(t)&&i.cts.declutter(!1)})},t.prototype.register_global_event_bindings=function(e,t){var i;i=this,$(window).bind("resize",function(){i.resize()}),this.elements.container.mousedown(function(e){i.state.inside=!0}),this.elements.container.contextmenu(function(e){e.preventDefault()}),$(window).mousemove(function(e){"selector"==i.state.mode?i.selector_update(e):"free"==i.state.mode&&i.selector_anchor(e)}),$(window).mouseup(function(e){1!=e.which&&3!=e.which||("free"==i.state.mode&&i.state.inside?(3==e.which&&i.options.actions.click.right&&i.delete_current(),i.selector_start(e),i.cts.hide_warning()):"selector"==i.state.mode&&i.selector_finish(e)),i.state.inside=!1})},t.prototype.update_radius=function(e){return e=void 0===this.cts?null:this.cts.update_radius(e)},t.prototype.resize=function(){var e,t,i,s,n,o,a,r,l;return zoom=this.state.zoom,5,e=$(window).width(),t=$(window).height(),i=this.elements.image.width,s=this.elements.image.height,zoom?(n=(o=t-10)/s*i,n=Math.min(n,e-10)):(n=this.elements.container.width(),limit1=this.options.limits.frame.width,limit2=this.options.limits.frame.height/s*i,n=Math.min(n,this.options.limits.frame.width,limit2)),o=n/i*s,zoom?(l=-1*(a=this.elements.container.offset()).left,l+=.5*(e-n),l+="px",r=a.top-5):(l="",r=0),$("html, body").animate({scrollTop:r}),this.elements.frame.css({width:n+"px",height:o+"px",left:l}),this.elements.container.css({height:o+"px",width:n+"px"}),void 0!==this.cts&&this.cts.resize(),this.refresh()},t.prototype.zoom_start=function(e){this.state.zoom=this.options.zoom.enabled,w1=this.elements.image.width,w2=this.elements.frame.width(),this.cts.zoom_modifier=w1/w2,this.selector_cancel(null),this.resize()},t.prototype.zoom_finish=function(e){this.state.zoom=!1,this.cts.zoom_modifier=1,this.selector_cancel(null),this.resize()},t.prototype.refresh=function(e){return void 0===this.cts?data=null:data=this.cts.refresh(e),null!=this.options.callbacks.onchange&&this.options.callbacks.onchange(data),data},t.prototype.delete_current=function(){if(this.cts.clear(),this.refresh(),null!=cta.options.callbacks.ondelete)return cta.options.callbacks.ondelete()},t.prototype.selector_start=function(e){if(started=this.cts.start(e,this.state.hover),started&&(this.state.mode="selector",null!=this.options.callbacks.onselector))return this.options.callbacks.onselector()},t.prototype.selector_update=function(e){this.cts.update_cursor(e)&&this.selector_finish(e,!1)},t.prototype.selector_anchor=function(e){this.state.hover=this.cts.update_anchor(e)},t.prototype.selector_cancel=function(e){this.selector_finish(null)},t.prototype.selector_finish=function(e,t){void 0!==t||(t=!0),"selector"==this.state.mode&&(complete=this.cts.finish(e,t),complete&&(this.state.mode="free",this.refresh()))},t.prototype.reset_existing=function(e){this.cts.draw_existing(),this.refresh()},t}()}).call(this);